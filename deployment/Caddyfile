{
    # Enable Coraza WAF
    order coraza_waf first
}

webvh.web3connect.nl {
    # 1. Apply OWASP Core Rule Set
    coraza_waf {
        directives `
            Include /etc/caddy/coraza.conf-recommended
            Include /etc/caddy/crs-setup.conf
            Include /etc/caddy/rules/*.conf
            SecRuleEngine On
        `
    }

    # 2. Route to Static Content Containers
    handle /.well-known/did/* {
        reverse_proxy did-static:80
    }

    handle_path /app/* {
        reverse_proxy frontend-static:80
    }

    # 3. Microservice Routing
    handle /api/identity/* {
        reverse_proxy identity:3000
    }

    handle /api/witness/* {
        reverse_proxy witness:3000
    }

    handle /api/watcher/* {
        reverse_proxy watcher:3000
    }

    # Default to Frontend
    handle {
        reverse_proxy frontend-static:80
    }

    tls email@example.com
}
