# Simplified Caddyfile for local development
:80 {
    # 1. Route API requests to microservices
    handle /api/identity/* {
        reverse_proxy identity:3000
    }

    handle /api/products/* {
        reverse_proxy identity:3000
    }

    handle /api/events/* {
        reverse_proxy identity:3000
    }

    handle /api/witness/* {
        reverse_proxy witness:3000
    }

    handle /api/watcher/* {
        reverse_proxy watcher:3000
    }

    # 2. DID resolution (static files)
    handle /.well-known/did/* {
        root * /usr/share/caddy/did
        file_server
    }

    # 3. Default to Frontend (SPA)
    handle {
        root * /usr/share/caddy/app
        try_files {path} /index.html
        file_server
    }

    # Enable logging
    log {
        output stdout
    }
}
